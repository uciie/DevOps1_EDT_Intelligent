@startuml

!theme plain
top to bottom direction
skinparam linetype ortho

interface TeamService << interface >> {
  + TeamService(): 
}

class CalendarImportService {
  + CalendarImportService(): 
  - defaultTimezone: String
  - syncWindowDays: int
  - eventRepository: EventRepository
  - parser: ICalendarParser
}

class TravelTimeService {
  + TravelTimeService(): 
  - travelTimeRepository: TravelTimeRepository
  - travelTimeCalculator: TravelTimeCalculator
  - eventRepository: EventRepository
}

class UserService {
  + UserService(): 
  - clientId: String
  - clientSecret: String
  - redirectUri: String
  - userRepository: UserRepository
   allUsers: List
}

interface TaskService << interface >> {
  + TaskService(): 
}

interface ICalendarParser << interface >> {
  + ICalendarParser(): 
}

class BiweeklyCalendarParser {
  + BiweeklyCalendarParser(): 
}

class SyncDelegateService {
  + SyncDelegateService(): 
  - calendarSyncService: CalendarSyncService
}

class ActivityLogService {
  + ActivityLogService(): 
  - activityLogRepository: ActivityLogRepository
  - eventRepository: EventRepository
}

class SimpleTravelTimeCalculator {
  + SimpleTravelTimeCalculator(): 
}

class TaskServiceImpl {
  + TaskServiceImpl(): 
  - taskRepository: TaskRepository
  - eventRepository: EventRepository
  - userRepository: UserRepository
  - teamRepository: TeamRepository
  - focusService: FocusService
}

class FocusService {
  + FocusService(): 
  - eventRepository: EventRepository
  - preferenceRepository: UserFocusPreferenceRepository
}

class TeamServiceImpl {
  + TeamServiceImpl(): 
  - teamRepository: TeamRepository
  - userRepository: UserRepository
  - invitationRepository: TeamInvitationRepository
  - taskRepository: TaskRepository
}

class EventServiceImpl {
  + EventServiceImpl(): 
  - eventRepository: EventRepository
  - userRepository: UserRepository
  - travelTimeService: TravelTimeService
  - travelTimeRepository: TravelTimeRepository
  - teamRepository: TeamRepository
  - primaryCalculator: TravelTimeCalculator
  - simpleCalculator: TravelTimeCalculator
  - syncDelegateService: SyncDelegateService
}

class GoogleMapsTravelTimeCalculator {
  + GoogleMapsTravelTimeCalculator(): 
  - apiKey: String
  - restTemplate: RestTemplate
  - fallbackCalculator: SimpleTravelTimeCalculator
  - mapper: ObjectMapper
}

class DefaultScheduleOptimizerService {
  + DefaultScheduleOptimizerService(): 
  - eventRepository: EventRepository
  - taskRepository: TaskRepository
  - taskSelectionStrategy: TaskSelectionStrategy
  - travelTimeService: TravelTimeService
  - focusService: FocusService
}

interface TaskSelectionStrategy << interface >> {
  + TaskSelectionStrategy(): 
}

class DefaultTaskSelectionStrategy {
  + DefaultTaskSelectionStrategy(): 
  - taskRepository: TaskRepository
}

class CalendarSyncService {
  + CalendarSyncService(): 
  - userRepository: UserRepository
  - eventRepository: EventRepository
  - googleCalendarService: GoogleCalendarService
  - calendarImportService: CalendarImportService
}

class GoogleCalendarService {
  + GoogleCalendarService(): 
  - defaultTimezone: String
  - clientId: String
  - clientSecret: String
  - eventRepository: EventRepository
  - userRepository: UserRepository
}

interface ScheduleOptimizerService << interface >> {
  + ScheduleOptimizerService(): 
}

class GeminiService {
  + GeminiService(): 
  - apiKey: String
  - model: String
  - httpClient: GeminiHttpClient
}

interface TravelTimeCalculator << interface >> {
  + TravelTimeCalculator(): 
}

class ChatbotService {
  + ChatbotService(): 
  - geminiService: GeminiService
  - eventRepository: EventRepository
  - taskRepository: TaskRepository
  - userRepository: UserRepository
}

interface EventService << interface >> {
  + EventService(): 
}

class CalendarSyncScheduler {
  + CalendarSyncScheduler(): 
  - userRepository: UserRepository
  - calendarSyncService: CalendarSyncService
}

class SyncConflictException {
  + SyncConflictException(): 
  - conflictDetails: SyncConflictDTO
   conflictDetails: SyncConflictDTO
}

class GoogleApiException {
  + GoogleApiException(): 
  - errorCode: String
  - isRetryable: boolean
   errorCode: String
}

interface TeamInvitationRepository << interface >> {
  + TeamInvitationRepository(): 
}

interface TravelTimeRepository << interface >> {
  + TravelTimeRepository(): 
}

interface ActivityLogRepository << interface >> {
  + ActivityLogRepository(): 
}

interface TeamRepository << interface >> {
  + TeamRepository(): 
}

interface TaskRepository << interface >> {
  + TaskRepository(): 
}

interface EventRepository << interface >> {
  + EventRepository(): 
}

interface LocationRepository << interface >> {
  + LocationRepository(): 
}

interface UserFocusPreferenceRepository << interface >> {
  + UserFocusPreferenceRepository(): 
}

interface UserRepository << interface >> {
  + UserRepository(): 
}

interface FocusBlockRepository << interface >> {
  + FocusBlockRepository(): 
}

class LegacyProfileEnvProcessor {
  + LegacyProfileEnvProcessor(): 
}

class WebConfig {
  + WebConfig(): 
}

class UmlGenerator {
  + UmlGenerator(): 
}

class TimeSlot {
  + TimeSlot(): 
  - start: LocalDateTime
  - end: LocalDateTime
   durationMinutes: long
}

class SyncConflictDTO {
  + SyncConflictDTO(): 
  - conflicts: List
  - message: String
  - hasConflicts: boolean
   message: String
   conflicts: List
}

class ActivityStatsDTO {
  + ActivityStatsDTO(): 
  - category: ActivityCategory
  - count: long
  - totalMinutes: long
  - averageMinutes: long
   count: long
   category: ActivityCategory
   totalMinutes: long
   averageMinutes: long
}

class ActivityLogController {
  + ActivityLogController(): 
  - activityLogService: ActivityLogService
}

class SyncController {
  + SyncController(): 
  - syncService: CalendarSyncService
}

class TaskController {
  + TaskController(): 
  - taskService: TaskService
  - focusService: FocusService
}

class ChatbotController {
  + ChatbotController(): 
  - chatbotService: ChatbotService
}

class FocusController {
  + FocusController(): 
  - focusService: FocusService
}

class ScheduleController {
  + ScheduleController(): 
  - optimizerService: ScheduleOptimizerService
}

class EventController {
  + EventController(): 
  - eventService: EventService
  - focusService: FocusService
}

class TeamController {
  + TeamController(): 
  - teamService: TeamService
}

class CalendarSyncController {
  + CalendarSyncController(): 
  - userRepository: UserRepository
  - calendarSyncService: CalendarSyncService
}

class TravelTimeController {
  + TravelTimeController(): 
  - travelTimeRepository: TravelTimeRepository
  - travelTimeService: TravelTimeService
}

class UserController {
  + UserController(): 
  - userService: UserService
  - username: String
  - password: String
  - id: String
   all: ResponseEntity
}

class CalendarImportController {
  + CalendarImportController(): 
  - importService: CalendarImportService
}

class BackendApplication {
  + BackendApplication(): 
}

class FallbackGeminiHttpClient {
  + FallbackGeminiHttpClient(): 
}

class RestGeminiHttpClient {
  + RestGeminiHttpClient(): 
  - webClient: WebClient
}

interface GeminiHttpClient << interface >> {
  + GeminiHttpClient(): 
}

class FocusBlock {
  + FocusBlock(): 
  - id: Long
  - user: User
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - flexibility: int
  - isProtected: boolean
  - status: String
  - suggestedBySystem: boolean
   id: Long
   startTime: LocalDateTime
   endTime: LocalDateTime
   user: User
   status: String
   flexibility: int
}

class TeamInvitation {
  + TeamInvitation(): 
  - id: Long
  - team: Team
  - invitedUser: User
  - inviter: User
  - status: Status
   id: Long
   team: Team
   status: Status
   invitedUser: User
   inviter: User
}

class TravelTime {
  + TravelTime(): 
  - id: Long
  - fromEvent: Event
  - toEvent: Event
  - user: User
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - durationMinutes: int
  - distanceKm: Double
  - mode: TransportMode
   id: Long
   startTime: LocalDateTime
   endTime: LocalDateTime
   user: User
   durationMinutes: int
   mode: TransportMode
   fromEvent: Event
   toEvent: Event
   distanceKm: Double
}

class Task {
  + Task(): 
  - id: Long
  - deadline: LocalDateTime
  - late: boolean
  - title: String
  - estimatedDuration: int
  - priority: int
  - status: TaskStatus
  - user: User
  - event: Event
  - assignee: User
  - team: Team
   priority: int
   id: Long
   duration: int
   user: User
   assignee: User
   team: Team
   title: String
   estimatedDuration: int
   status: TaskStatus
   deadline: LocalDateTime
   event: Event
   userId: Long
   eventId: Long
}

enum ActivityCategory << enumeration >> {
  + ActivityCategory(): 
  + TRAVAIL
  + ETUDE
  + SPORT
  + LOISIR
  + MENAGER
  + RENCONTRE
  + FOCUS
  + AUTRE
}

class User {
  + User(): 
  - id: Long
  - username: String
  - password: String
  - events: List
  - tasks: List
  - teams: Set
  - googleAccessToken: String
  - googleRefreshToken: String
   id: Long
   googleAccessToken: String
   events: List
   password: String
   teams: Set
   googleRefreshToken: String
   username: String
   tasks: List
}

class ActivityLog {
  + ActivityLog(): 
  - id: Long
  - userId: Long
  - activityType: ActivityCategory
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - eventId: Long
   id: Long
   startTime: LocalDateTime
   endTime: LocalDateTime
   activityType: ActivityCategory
   userId: Long
   eventId: Long
}

class Team {
  + Team(): 
  - id: Long
  - name: String
  - description: String
  - ownerId: Long
  - members: Set
   name: String
   id: Long
   members: Set
   ownerId: Long
   description: String
}

class Event {
  + Event(): 
  - id: Long
  - summary: String
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - category: ActivityCategory
  - location: Location
  - user: User
  - task: Task
  - departures: List
  - arrivals: List
  - status: EventStatus
  - googleEventId: String
  - lastSyncedAt: LocalDateTime
  - source: EventSource
  - syncStatus: SyncStatus
   location: Location
   id: Long
   source: EventSource
   summary: String
   syncStatus: SyncStatus
   startTime: LocalDateTime
   endTime: LocalDateTime
   googleEventId: String
   user: User
   category: ActivityCategory
   task: Task
   status: EventStatus
   userId: Long
   lastSyncedAt: LocalDateTime
}

class UserFocusPreference {
  + UserFocusPreference(): 
  - userId: Long
  - maxEventsPerDay: int
  - minFocusDuration: int
  - focusModeEnabled: boolean
  - preferredFocusTime: FocusTimePreference
   maxEventsPerDay: int
   minFocusDuration: int
   preferredFocusTime: FocusTimePreference
   userId: Long
}

class Location {
  + Location(): 
  - id: Long
  - address: String
  - latitude: Double
  - longitude: Double
  - name: String
  - autoCompleted: boolean
   name: String
   id: Long
   address: String
   displayName: String
   latitude: Double
   longitude: Double
   fullDescription: String
}

CalendarImportService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
CalendarImportService "1" *-[#595959,plain]-> "parser\n1" ICalendarParser
TravelTimeService "1" *-[#595959,plain]-> "travelTimeRepository\n1" TravelTimeRepository
TravelTimeService "1" *-[#595959,plain]-> "travelTimeCalculator\n1" TravelTimeCalculator
TravelTimeService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
UserService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
ICalendarParser <|.. BiweeklyCalendarParser
SyncDelegateService "1" *-[#595959,plain]-> "calendarSyncService\n1" CalendarSyncService
ActivityLogService "1" *-[#595959,plain]-> "activityLogRepository\n1" ActivityLogRepository
ActivityLogService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
TravelTimeCalculator <|.. SimpleTravelTimeCalculator
TaskService <|.. TaskServiceImpl
TaskServiceImpl "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
TaskServiceImpl "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
TaskServiceImpl "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
TaskServiceImpl "1" *-[#595959,plain]-> "teamRepository\n1" TeamRepository
TaskServiceImpl "1" *-[#595959,plain]-> "focusService\n1" FocusService
FocusService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
FocusService "1" *-[#595959,plain]-> "preferenceRepository\n1" UserFocusPreferenceRepository
TeamService <|.. TeamServiceImpl
TeamServiceImpl "1" *-[#595959,plain]-> "teamRepository\n1" TeamRepository
TeamServiceImpl "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
TeamServiceImpl "1" *-[#595959,plain]-> "invitationRepository\n1" TeamInvitationRepository
TeamServiceImpl "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
EventService <|.. EventServiceImpl
EventServiceImpl "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
EventServiceImpl "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
EventServiceImpl "1" *-[#595959,plain]-> "travelTimeService\n1" TravelTimeService
EventServiceImpl "1" *-[#595959,plain]-> "travelTimeRepository\n1" TravelTimeRepository
EventServiceImpl "1" *-[#595959,plain]-> "teamRepository\n1" TeamRepository
EventServiceImpl "1" *-[#595959,plain]-> "primaryCalculator\n1" TravelTimeCalculator
EventServiceImpl "1" *-[#595959,plain]-> "simpleCalculator\n1" TravelTimeCalculator
EventServiceImpl "1" *-[#595959,plain]-> "syncDelegateService\n1" SyncDelegateService
TravelTimeCalculator <|.. GoogleMapsTravelTimeCalculator
GoogleMapsTravelTimeCalculator "1" *-[#595959,plain]-> "fallbackCalculator\n1" SimpleTravelTimeCalculator
ScheduleOptimizerService <|.. DefaultScheduleOptimizerService
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "taskSelectionStrategy\n1" TaskSelectionStrategy
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "travelTimeService\n1" TravelTimeService
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "focusService\n1" FocusService
TaskSelectionStrategy <|.. DefaultTaskSelectionStrategy
DefaultTaskSelectionStrategy "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
CalendarSyncService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
CalendarSyncService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
CalendarSyncService "1" *-[#595959,plain]-> "googleCalendarService\n1" GoogleCalendarService
CalendarSyncService "1" *-[#595959,plain]-> "calendarImportService\n1" CalendarImportService
GoogleCalendarService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
GoogleCalendarService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
GeminiService "1" *-[#595959,plain]-> "httpClient\n1" GeminiHttpClient
ChatbotService "1" *-[#595959,plain]-> "geminiService\n1" GeminiService
ChatbotService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
ChatbotService "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
ChatbotService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
CalendarSyncScheduler "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
CalendarSyncScheduler "1" *-[#595959,plain]-> "calendarSyncService\n1" CalendarSyncService
SyncConflictException "1" *-[#595959,plain]-> "conflictDetails\n1" SyncConflictDTO
ActivityStatsDTO "1" *-[#595959,plain]-> "category\n1" ActivityCategory
ActivityLogController "1" *-[#595959,plain]-> "activityLogService\n1" ActivityLogService
SyncController "1" *-[#595959,plain]-> "syncService\n1" CalendarSyncService
TaskController "1" *-[#595959,plain]-> "taskService\n1" TaskService
TaskController "1" *-[#595959,plain]-> "focusService\n1" FocusService
ChatbotController "1" *-[#595959,plain]-> "chatbotService\n1" ChatbotService
FocusController "1" *-[#595959,plain]-> "focusService\n1" FocusService
ScheduleController "1" *-[#595959,plain]-> "optimizerService\n1" ScheduleOptimizerService
EventController "1" *-[#595959,plain]-> "eventService\n1" EventService
EventController "1" *-[#595959,plain]-> "focusService\n1" FocusService
TeamController "1" *-[#595959,plain]-> "teamService\n1" TeamService
CalendarSyncController "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
CalendarSyncController "1" *-[#595959,plain]-> "calendarSyncService\n1" CalendarSyncService
TravelTimeController "1" *-[#595959,plain]-> "travelTimeRepository\n1" TravelTimeRepository
TravelTimeController "1" *-[#595959,plain]-> "travelTimeService\n1" TravelTimeService
UserController "1" *-[#595959,plain]-> "userService\n1" UserService
CalendarImportController "1" *-[#595959,plain]-> "importService\n1" CalendarImportService
GeminiHttpClient <|.. FallbackGeminiHttpClient
GeminiHttpClient <|.. RestGeminiHttpClient
FocusBlock "1" *-[#595959,plain]-> "user\n1" User
TeamInvitation "1" *-[#595959,plain]-> "team\n1" Team
TeamInvitation "1" *-[#595959,plain]-> "invitedUser\n1" User
TeamInvitation "1" *-[#595959,plain]-> "inviter\n1" User
TravelTime "1" *-[#595959,plain]-> "fromEvent\n1" Event
TravelTime "1" *-[#595959,plain]-> "toEvent\n1" Event
TravelTime "1" *-[#595959,plain]-> "user\n1" User
Task "1" *-[#595959,plain]-> "user\n1" User
Task "1" *-[#595959,plain]-> "event\n1" Event
Task "1" *-[#595959,plain]-> "assignee\n1" User
Task "1" *-[#595959,plain]-> "team\n1" Team
ActivityCategory "1" *-[#595959,plain]-> "TRAVAIL\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "ETUDE\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "SPORT\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "LOISIR\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "MENAGER\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "RENCONTRE\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "FOCUS\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "AUTRE\n1" ActivityCategory
User "1" *-[#595959,plain]-> "events\n*" Event
User "1" *-[#595959,plain]-> "tasks\n*" Task
User "1" *-[#595959,plain]-> "teams\n*" Team
ActivityLog "1" *-[#595959,plain]-> "activityType\n1" ActivityCategory
Team "1" *-[#595959,plain]-> "members\n*" User
Event "1" *-[#595959,plain]-> "category\n1" ActivityCategory
Event "1" *-[#595959,plain]-> "location\n1" Location
Event "1" *-[#595959,plain]-> "user\n1" User
Event "1" *-[#595959,plain]-> "task\n1" Task
Event "1" *-[#595959,plain]-> "departures\n*" TravelTime
Event "1" *-[#595959,plain]-> "arrivals\n*" TravelTime

@enduml
!pragma useVerticalIf on
skinparam dpi 300
allow_mixing
set maxMessageSize 8192
skinparam nodesep 50
skinparam ranksep 50

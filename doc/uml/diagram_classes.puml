@startuml

!theme plain
top to bottom direction
skinparam linetype ortho

class BackendApplication {
  + BackendApplication(): 
}

class LegacyProfileEnvProcessor {
  + LegacyProfileEnvProcessor(): 
}

class WebConfig {
  + WebConfig(): 
}

class ActivityLogController {
  + ActivityLogController(): 
  - activityLogService: ActivityLogService
}

class CalendarImportController {
  + CalendarImportController(): 
  - importService: CalendarImportService
}

class ChatbotController {
  + ChatbotController(): 
  - chatbotService: ChatbotService
}

class EventController {
  + EventController(): 
  - eventService: EventService
  - focusService: FocusService
}

class FocusController {
  + FocusController(): 
  - focusService: FocusService
}

class ScheduleController {
  + ScheduleController(): 
  - optimizerService: ScheduleOptimizerService
}

class TaskController {
  + TaskController(): 
  - taskService: TaskService
  - focusService: FocusService
}

class TeamController {
  + TeamController(): 
  - teamService: TeamService
}

class TravelTimeController {
  + TravelTimeController(): 
  - travelTimeRepository: TravelTimeRepository
  - travelTimeService: TravelTimeService
}

class UserController {
  + UserController(): 
  - userService: UserService
  - username: String
  - password: String
  - id: String
   all: ResponseEntity
}

class ActivityStatsDTO {
  + ActivityStatsDTO(): 
  - category: ActivityCategory
  - count: long
  - totalMinutes: long
  - averageMinutes: long
   totalMinutes: long
   averageMinutes: long
   category: ActivityCategory
   count: long
}

class TimeSlot {
  + TimeSlot(): 
  - start: LocalDateTime
  - end: LocalDateTime
   durationMinutes: long
}

enum ConflictResolutionStrategy << enumeration >> {
  + ConflictResolutionStrategy(): 
  + GOOGLE_PRIORITY
  + LOCAL_PRIORITY
  + ASK_USER
}

class FallbackGeminiHttpClient {
  + FallbackGeminiHttpClient(): 
}

interface GeminiHttpClient << interface >> {
  + GeminiHttpClient(): 
}

class RestGeminiHttpClient {
  + RestGeminiHttpClient(): 
  - webClient: WebClient
}

enum ActivityCategory << enumeration >> {
  + ActivityCategory(): 
  + TRAVAIL
  + ETUDE
  + SPORT
  + LOISIR
  + MENAGER
  + RENCONTRE
  + AUTRE
}

class ActivityLog {
  + ActivityLog(): 
  - id: Long
  - userId: Long
  - activityType: ActivityCategory
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - eventId: Long
   startTime: LocalDateTime
   activityType: ActivityCategory
   id: Long
   userId: Long
   endTime: LocalDateTime
   eventId: Long
}

class Event {
  + Event(): 
  - id: Long
  - summary: String
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - category: ActivityCategory
  - location: Location
  - user: User
  - task: Task
  - departures: List
  - arrivals: List
  - status: EventStatus
  - googleEventId: String
  - lastSyncedAt: LocalDateTime
  - updatedAt: LocalDateTime
  - source: EventSource
  - syncStatus: SyncStatus
   source: EventSource
   startTime: LocalDateTime
   category: ActivityCategory
   googleEventId: String
   syncStatus: SyncStatus
   updatedAt: LocalDateTime
   lastSyncedAt: LocalDateTime
   location: Location
   id: Long
   userId: Long
   endTime: LocalDateTime
   user: User
   summary: String
   status: EventStatus
   task: Task
}

class EventConflict {
  + EventConflict(): 
  - id: Long
  - user: User
  - googleEventId: String
  - localTitle: String
  - localDescription: String
  - localStartTime: LocalDateTime
  - localEndTime: LocalDateTime
  - localLastModified: LocalDateTime
  - googleTitle: String
  - googleDescription: String
  - googleStartTime: LocalDateTime
  - googleEndTime: LocalDateTime
  - googleLastModified: LocalDateTime
  - detectedAt: LocalDateTime
  - resolved: boolean
  - resolvedAt: LocalDateTime
  - chosenResolution: ConflictResolution
   googleEventId: String
   localTitle: String
   localDescription: String
   localStartTime: LocalDateTime
   localEndTime: LocalDateTime
   localLastModified: LocalDateTime
   googleDescription: String
   googleStartTime: LocalDateTime
   googleEndTime: LocalDateTime
   googleLastModified: LocalDateTime
   detectedAt: LocalDateTime
   chosenResolution: ConflictResolution
   resolvedAt: LocalDateTime
   googleTitle: String
   id: Long
   user: User
}

class FocusBlock {
  + FocusBlock(): 
  - id: Long
  - user: User
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - flexibility: int
  - isProtected: boolean
  - status: String
  - suggestedBySystem: boolean
   startTime: LocalDateTime
   flexibility: int
   id: Long
   endTime: LocalDateTime
   user: User
   status: String
}

class Location {
  + Location(): 
  - id: Long
  - address: String
  - latitude: Double
  - longitude: Double
  - name: String
  - autoCompleted: boolean
   longitude: Double
   fullDescription: String
   latitude: Double
   name: String
   id: Long
   address: String
   displayName: String
}

class Task {
  + Task(): 
  - id: Long
  - deadline: LocalDateTime
  - late: boolean
  - title: String
  - estimatedDuration: int
  - priority: int
  - status: TaskStatus
  - user: User
  - event: Event
  - assignee: User
  - team: Team
   estimatedDuration: int
   assignee: User
   deadline: LocalDateTime
   priority: int
   id: Long
   duration: int
   userId: Long
   eventId: Long
   user: User
   status: TaskStatus
   team: Team
   title: String
   event: Event
}

class Team {
  + Team(): 
  - id: Long
  - name: String
  - description: String
  - ownerId: Long
  - members: Set
   description: String
   name: String
   id: Long
   members: Set
   ownerId: Long
}

class TeamInvitation {
  + TeamInvitation(): 
  - id: Long
  - team: Team
  - invitedUser: User
  - inviter: User
  - status: Status
   invitedUser: User
   id: Long
   status: Status
   team: Team
   inviter: User
}

class TravelTime {
  + TravelTime(): 
  - id: Long
  - fromEvent: Event
  - toEvent: Event
  - user: User
  - startTime: LocalDateTime
  - endTime: LocalDateTime
  - durationMinutes: int
  - distanceKm: Double
  - mode: TransportMode
   startTime: LocalDateTime
   distanceKm: Double
   fromEvent: Event
   durationMinutes: int
   id: Long
   endTime: LocalDateTime
   user: User
   toEvent: Event
   mode: TransportMode
}

class User {
  + User(): 
  - id: Long
  - username: String
  - password: String
  - events: List
  - tasks: List
  - teams: Set
  - googleAccessToken: String
  - googleRefreshToken: String
  - lastSyncDate: LocalDateTime
  - conflictStrategy: ConflictResolutionStrategy
  - createdAt: LocalDateTime
  - updatedAt: LocalDateTime
   username: String
   password: String
   googleAccessToken: String
   conflictStrategy: ConflictResolutionStrategy
   googleRefreshToken: String
   lastSyncDate: LocalDateTime
   id: Long
   teams: Set
   tasks: List
   events: List
}

class UserFocusPreference {
  + UserFocusPreference(): 
  - userId: Long
  - maxEventsPerDay: int
  - minFocusDuration: int
  - focusModeEnabled: boolean
  - preferredFocusTime: FocusTimePreference
   maxEventsPerDay: int
   minFocusDuration: int
   preferredFocusTime: FocusTimePreference
   userId: Long
}

interface ActivityLogRepository << interface >> {
  + ActivityLogRepository(): 
}

interface EventConflictRepository << interface >> {
  + EventConflictRepository(): 
}

interface EventRepository << interface >> {
  + EventRepository(): 
}

interface FocusBlockRepository << interface >> {
  + FocusBlockRepository(): 
}

interface LocationRepository << interface >> {
  + LocationRepository(): 
}

interface TaskRepository << interface >> {
  + TaskRepository(): 
}

interface TeamInvitationRepository << interface >> {
  + TeamInvitationRepository(): 
}

interface TeamRepository << interface >> {
  + TeamRepository(): 
}

interface TravelTimeRepository << interface >> {
  + TravelTimeRepository(): 
}

interface UserFocusPreferenceRepository << interface >> {
  + UserFocusPreferenceRepository(): 
}

interface UserRepository << interface >> {
  + UserRepository(): 
}

class ActivityLogService {
  + ActivityLogService(): 
  - activityLogRepository: ActivityLogRepository
  - eventRepository: EventRepository
}

class CalendarImportService {
  + CalendarImportService(): 
  - eventRepository: EventRepository
  - parser: ICalendarParser
}

class CalendarSyncService {
  + CalendarSyncService(): 
  - eventRepository: EventRepository
  - userRepository: UserRepository
  - googleCalendarService: GoogleCalendarService
  - conflictService: ConflictResolutionService
}

class ChatbotService {
  + ChatbotService(): 
  - geminiService: GeminiService
  - eventRepository: EventRepository
  - taskRepository: TaskRepository
  - userRepository: UserRepository
}

class ConflictResolutionService {
  + ConflictResolutionService(): 
  - conflictRepository: EventConflictRepository
  - eventRepository: EventRepository
}

interface EventService << interface >> {
  + EventService(): 
}

class GeminiService {
  + GeminiService(): 
  - apiKey: String
  - model: String
  - httpClient: GeminiHttpClient
}

class GoogleCalendarService {
  + GoogleCalendarService(): 
  - userRepository: UserRepository
}

class DefaultScheduleOptimizerService {
  + DefaultScheduleOptimizerService(): 
  - eventRepository: EventRepository
  - taskRepository: TaskRepository
  - taskSelectionStrategy: TaskSelectionStrategy
  - travelTimeService: TravelTimeService
  - focusService: FocusService
}

class EventServiceImpl {
  + EventServiceImpl(): 
  - eventRepository: EventRepository
  - userRepository: UserRepository
  - travelTimeService: TravelTimeService
  - travelTimeRepository: TravelTimeRepository
  - teamRepository: TeamRepository
  - primaryCalculator: TravelTimeCalculator
  - simpleCalculator: TravelTimeCalculator
}

class FocusService {
  + FocusService(): 
  - eventRepository: EventRepository
  - preferenceRepository: UserFocusPreferenceRepository
}

class GoogleMapsTravelTimeCalculator {
  + GoogleMapsTravelTimeCalculator(): 
  - apiKey: String
  - restTemplate: RestTemplate
  - fallbackCalculator: SimpleTravelTimeCalculator
  - mapper: ObjectMapper
}

class SimpleTravelTimeCalculator {
  + SimpleTravelTimeCalculator(): 
}

class TaskServiceImpl {
  + TaskServiceImpl(): 
  - taskRepository: TaskRepository
  - eventRepository: EventRepository
  - userRepository: UserRepository
  - teamRepository: TeamRepository
  - focusService: FocusService
}

class TeamServiceImpl {
  + TeamServiceImpl(): 
  - teamRepository: TeamRepository
  - userRepository: UserRepository
  - invitationRepository: TeamInvitationRepository
  - taskRepository: TaskRepository
}

class BiweeklyCalendarParser {
  + BiweeklyCalendarParser(): 
}

interface ICalendarParser << interface >> {
  + ICalendarParser(): 
}

interface ScheduleOptimizerService << interface >> {
  + ScheduleOptimizerService(): 
}

class DefaultTaskSelectionStrategy {
  + DefaultTaskSelectionStrategy(): 
  - taskRepository: TaskRepository
}

interface TaskSelectionStrategy << interface >> {
  + TaskSelectionStrategy(): 
}

interface TaskService << interface >> {
  + TaskService(): 
}

interface TeamService << interface >> {
  + TeamService(): 
}

interface TravelTimeCalculator << interface >> {
  + TravelTimeCalculator(): 
}

class TravelTimeService {
  + TravelTimeService(): 
  - travelTimeRepository: TravelTimeRepository
  - travelTimeCalculator: TravelTimeCalculator
  - eventRepository: EventRepository
}

class UserService {
  + UserService(): 
  - clientId: String
  - clientSecret: String
  - redirectUri: String
  - userRepository: UserRepository
   allUsers: List
}

class UmlGenerator {
  + UmlGenerator(): 
}

ActivityLogController "1" *-[#595959,plain]-> "activityLogService\n1" ActivityLogService
CalendarImportController "1" *-[#595959,plain]-> "importService\n1" CalendarImportService
ChatbotController "1" *-[#595959,plain]-> "chatbotService\n1" ChatbotService
EventController "1" *-[#595959,plain]-> "eventService\n1" EventService
EventController "1" *-[#595959,plain]-> "focusService\n1" FocusService
FocusController "1" *-[#595959,plain]-> "focusService\n1" FocusService
ScheduleController "1" *-[#595959,plain]-> "optimizerService\n1" ScheduleOptimizerService
TaskController "1" *-[#595959,plain]-> "taskService\n1" TaskService
TaskController "1" *-[#595959,plain]-> "focusService\n1" FocusService
TeamController "1" *-[#595959,plain]-> "teamService\n1" TeamService
TravelTimeController "1" *-[#595959,plain]-> "travelTimeRepository\n1" TravelTimeRepository
TravelTimeController "1" *-[#595959,plain]-> "travelTimeService\n1" TravelTimeService
UserController "1" *-[#595959,plain]-> "userService\n1" UserService
ActivityStatsDTO "1" *-[#595959,plain]-> "category\n1" ActivityCategory
ConflictResolutionStrategy "1" *-[#595959,plain]-> "GOOGLE_PRIORITY\n1" ConflictResolutionStrategy
ConflictResolutionStrategy "1" *-[#595959,plain]-> "LOCAL_PRIORITY\n1" ConflictResolutionStrategy
ConflictResolutionStrategy "1" *-[#595959,plain]-> "ASK_USER\n1" ConflictResolutionStrategy
GeminiHttpClient <|.. FallbackGeminiHttpClient
GeminiHttpClient <|.. RestGeminiHttpClient
ActivityCategory "1" *-[#595959,plain]-> "TRAVAIL\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "ETUDE\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "SPORT\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "LOISIR\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "MENAGER\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "RENCONTRE\n1" ActivityCategory
ActivityCategory "1" *-[#595959,plain]-> "AUTRE\n1" ActivityCategory
ActivityLog "1" *-[#595959,plain]-> "activityType\n1" ActivityCategory
Event "1" *-[#595959,plain]-> "category\n1" ActivityCategory
Event "1" *-[#595959,plain]-> "location\n1" Location
Event "1" *-[#595959,plain]-> "user\n1" User
Event "1" *-[#595959,plain]-> "task\n1" Task
Event "1" *-[#595959,plain]-> "departures\n*" TravelTime
Event "1" *-[#595959,plain]-> "arrivals\n*" TravelTime
EventConflict "1" *-[#595959,plain]-> "user\n1" User
FocusBlock "1" *-[#595959,plain]-> "user\n1" User
Task "1" *-[#595959,plain]-> "user\n1" User
Task "1" *-[#595959,plain]-> "event\n1" Event
Task "1" *-[#595959,plain]-> "assignee\n1" User
Task "1" *-[#595959,plain]-> "team\n1" Team
Team "1" *-[#595959,plain]-> "members\n*" User
TeamInvitation "1" *-[#595959,plain]-> "team\n1" Team
TeamInvitation "1" *-[#595959,plain]-> "invitedUser\n1" User
TeamInvitation "1" *-[#595959,plain]-> "inviter\n1" User
TravelTime "1" *-[#595959,plain]-> "fromEvent\n1" Event
TravelTime "1" *-[#595959,plain]-> "toEvent\n1" Event
TravelTime "1" *-[#595959,plain]-> "user\n1" User
User "1" *-[#595959,plain]-> "events\n*" Event
User "1" *-[#595959,plain]-> "tasks\n*" Task
User "1" *-[#595959,plain]-> "teams\n*" Team
User "1" *-[#595959,plain]-> "conflictStrategy\n1" ConflictResolutionStrategy
ActivityLogService "1" *-[#595959,plain]-> "activityLogRepository\n1" ActivityLogRepository
ActivityLogService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
CalendarImportService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
CalendarImportService "1" *-[#595959,plain]-> "parser\n1" ICalendarParser
CalendarSyncService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
CalendarSyncService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
CalendarSyncService "1" *-[#595959,plain]-> "googleCalendarService\n1" GoogleCalendarService
CalendarSyncService "1" *-[#595959,plain]-> "conflictService\n1" ConflictResolutionService
ChatbotService "1" *-[#595959,plain]-> "geminiService\n1" GeminiService
ChatbotService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
ChatbotService "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
ChatbotService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
ConflictResolutionService "1" *-[#595959,plain]-> "conflictRepository\n1" EventConflictRepository
ConflictResolutionService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
GeminiService "1" *-[#595959,plain]-> "httpClient\n1" GeminiHttpClient
GoogleCalendarService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
ScheduleOptimizerService <|.. DefaultScheduleOptimizerService
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "taskSelectionStrategy\n1" TaskSelectionStrategy
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "travelTimeService\n1" TravelTimeService
DefaultScheduleOptimizerService "1" *-[#595959,plain]-> "focusService\n1" FocusService
EventService <|.. EventServiceImpl
EventServiceImpl "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
EventServiceImpl "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
EventServiceImpl "1" *-[#595959,plain]-> "travelTimeService\n1" TravelTimeService
EventServiceImpl "1" *-[#595959,plain]-> "travelTimeRepository\n1" TravelTimeRepository
EventServiceImpl "1" *-[#595959,plain]-> "teamRepository\n1" TeamRepository
EventServiceImpl "1" *-[#595959,plain]-> "primaryCalculator\n1" TravelTimeCalculator
EventServiceImpl "1" *-[#595959,plain]-> "simpleCalculator\n1" TravelTimeCalculator
FocusService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
FocusService "1" *-[#595959,plain]-> "preferenceRepository\n1" UserFocusPreferenceRepository
TravelTimeCalculator <|.. GoogleMapsTravelTimeCalculator
GoogleMapsTravelTimeCalculator "1" *-[#595959,plain]-> "fallbackCalculator\n1" SimpleTravelTimeCalculator
TravelTimeCalculator <|.. SimpleTravelTimeCalculator
TaskService <|.. TaskServiceImpl
TaskServiceImpl "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
TaskServiceImpl "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
TaskServiceImpl "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
TaskServiceImpl "1" *-[#595959,plain]-> "teamRepository\n1" TeamRepository
TaskServiceImpl "1" *-[#595959,plain]-> "focusService\n1" FocusService
TeamService <|.. TeamServiceImpl
TeamServiceImpl "1" *-[#595959,plain]-> "teamRepository\n1" TeamRepository
TeamServiceImpl "1" *-[#595959,plain]-> "userRepository\n1" UserRepository
TeamServiceImpl "1" *-[#595959,plain]-> "invitationRepository\n1" TeamInvitationRepository
TeamServiceImpl "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
ICalendarParser <|.. BiweeklyCalendarParser
TaskSelectionStrategy <|.. DefaultTaskSelectionStrategy
DefaultTaskSelectionStrategy "1" *-[#595959,plain]-> "taskRepository\n1" TaskRepository
TravelTimeService "1" *-[#595959,plain]-> "travelTimeRepository\n1" TravelTimeRepository
TravelTimeService "1" *-[#595959,plain]-> "travelTimeCalculator\n1" TravelTimeCalculator
TravelTimeService "1" *-[#595959,plain]-> "eventRepository\n1" EventRepository
UserService "1" *-[#595959,plain]-> "userRepository\n1" UserRepository

@enduml
!pragma useVerticalIf on
skinparam dpi 300
allow_mixing
set maxMessageSize 8192
skinparam nodesep 50
skinparam ranksep 50
